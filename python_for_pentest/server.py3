# Ref.
# https://youtu.be/F1QI9tNuDQg?si=TSGI_tqjVCu0Mpzh

import socket

# create socket object (IPv4, TCP)
serversocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# host = socket.gethostbyname('localhost')
host = socket.gethostname()
port = 444

# bind server socket
serversocket.bind((host, port))

# Number of connection: 3
serversocket.listen(3)

while True:
  clientsocket, address  = serversocket.accept()

  # Note: original video use %s.
  # print("received connection from %s " % str(address))
  print("received connection from {0}".format(address))

  # send message as response (Must be byte type)
  # Use message.encode(...) following video tutorial.
  message = "Hello! Thank you for connecting to the server.\r\n"
  clientsocket.send(message.encode('ascii'))

  clientsocket.close()

"""
# run python script with loopback address
% sudo python server.py3
received connection from ('127.0.0.1', 64540)
received connection from ('127.0.0.1', 64547)

....

# connect via netcat command.
% nc -zv 127.0.0.1 444
Connection to 127.0.0.1 port 444 [tcp/snpp] succeeded!
% nc localhost 444
Hello! Thank you for connecting to the server.
"""
